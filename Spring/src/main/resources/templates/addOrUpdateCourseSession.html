<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Quản lý buổi học</title>
        <th:block th:replace="base :: bootstrap"></th:block>
    </head>
    <body>
        <main class="container">
            <div th:replace="base :: header"></div>
            <h1 class="text-center text-info mt-1">QUẢN LÝ BUỔI HỌC</h1>
            <form method="post" th:action="@{/addOrUpdateCourseSession}" th:object="${courseSession}">
                
                <!-- Mã buổi học -->
                <div class="mb-3 mt-3">
                    <label for="maxSlots" class="form-label">Mã buổi học:</label>
                    <input type="text" class="form-control" id="code" th:field="*{code}" th:readonly="${courseSession.id != null}"/>
                </div>
                
                <!-- Môn học -->
                <div class="mb-3 mt-3">
                    <label for="courseName" class="form-label">Môn học:</label>
                    <input type="text" class="form-control" id="courseName" list="coursesList" 
                           placeholder="Nhập tên môn học..." th:readonly="${courseSession.id != null}"
                           th:value="${param.courseName}">
                    <datalist id="coursesList">
                        <option th:each="course : ${courses}" 
                                th:data-id="${course[0]}" 
                                th:value="${course[1]}"></option>
                    </datalist>
                    <!-- Hidden field để gửi ID -->
                    <input type="hidden" th:field="*{courseId}" id="courseId">
                </div>


                <!-<!-- Giảng viên -->
                <div class="mb-3 mt-3">
                    <label for="teacherName" class="form-label">Giảng viên:</label>
                    <input type="text" class="form-control" id="teacherName" 
                           list="teachersList" placeholder="Nhập tên giảng viên..." 
                           th:readonly="${courseSession.id != null}"
                           th:value="${param.teacherName}">
                    <datalist id="teachersList">
                        <option th:each="teacher : ${teachers}" 
                                th:data-id="${teacher[0]}" 
                                th:value="${teacher[1]}"></option>
                    </datalist>
                    <input type="hidden" th:field="*{teacherId}" id="teacherId">
                </div>

                <!-- Slot hiện tại -->
<!--                <div class="mb-3 mt-3" th:if="${courseSession.id != null}">
                    <label for="slot" class="form-label">Slot hiện tại:</label>
                    <input type="number" class="form-control" id="slot" th:field="*{slot}" min="0" readonly />
                </div>-->

                <!-- Trạng thái mở -->
                <div class="form-check mb-3 mt-3">
                    <input type="checkbox" class="form-check-input" id="isOpen" th:field="*{isOpen}" />
                    <label class="form-check-label" for="isOpen">Lớp đang mở</label>
                </div>

                <!-- Hidden ID nếu đang cập nhật -->
                <input type="hidden" th:field="*{id}" />

                <!-- Nút submit -->
                <div class="mb-3 mt-3">
                    <button class="btn btn-success mt-1" type="submit">
                        <span th:if="${courseSession.id == null}">Thêm buổi học</span>
                        <span th:unless="${courseSession.id == null}">Cập nhật buổi học</span>
                    </button>
                </div>
            </form>

            <div th:replace="base :: footer"></div>
            
            <script>
                document.getElementById('courseName').addEventListener('input', function () {
                    const input = this.value;
                    const list = document.getElementById('coursesList').options;
                    for (let i = 0; i < list.length; i++) {
                        if (list[i].value === input) {
                            document.getElementById('courseId').value = list[i].getAttribute('data-id');
                            break;
                        }
                    }
                });

                document.getElementById('teacherName').addEventListener('input', function () {
                    const input = this.value;
                    const list = document.getElementById('teachersList').options;
                    for (let i = 0; i < list.length; i++) {
                        if (list[i].value === input) {
                            document.getElementById('teacherId').value = list[i].getAttribute('data-id');
                            break;
                        }
                    }
                });
            </script>
        </main>
    </body>
</html>
